<div class="container">

    <h2>
        <ul class="breadcrumb">
            <li><a href="/admin/survey">Surveys</a></li>
            <li><a href="/admin/survey/edit/{{survey.id}}#1">{{survey.code}}</a></li>
            <li class="active">{{question.name}}</li>
        </ul>
    </h2>


    <form novalidate name="myForm">

        <?php echo $this->crudButtons('question'); ?>

        <br/><br/>

        <div class="control-group form-horizontal row-fluid"  ng-class="{error: myForm.name.$invalid}">
            <label class='control-label' for="question.name">Label</label>
            <div class='controls span10'>
                <div class='span6'><input class='span12' type="text" name="name" ng-model="question.name" required/></div>
                <span ng-show="myForm.name.$error.required" class="span2 help-inline">Required</span>
            </div>
        </div>




        <div class="control-group form-horizontal row-fluid" ng-class="{error: myForm.type.$invalid}">
            <label class='control-label' for="type">Type</label>
            <div class='controls span10'>
                <div class='span6'>
                    <select required
                            class='span12'
                            name="type"
                            ng-model="question.type"
                            ng-change="initChoices()"
                            ng-options="c.value as c.text for c in types">
                    </select>
                </div>
                <span ng-show="myForm.type.$error.required" class="span2 help-inline">Required</span>
            </div>
        </div>




        <div class="control-group form-horizontal row-fluid" ng-show='isChoices'>
            <label class='control-label'></label>
            <div class='control-row span10'>
                <label class='radio'><input type='radio' name='question.isMultiple' value='0' ng-model='question.isMultiple' ng-checked="1">Single choice</label>
                <label class='radio'><input type='radio' name='question.isMultiple' value='1' ng-model='question.isMultiple'>Multiple choices</label>
            </div>
        </div>

        <div class="control-group form-horizontal row-fluid" ng-hide='isChapter'>
            <label class='control-label' for="question.isCompulsory"></label>
            <div class='control-row span10'>
                <label class='radio'><input type='radio' name='question.isCompulsory' value='0' ng-model='question.isCompulsory' ng-checked="1">Optional</label>
                <label class='radio'><input type='radio' name='question.isCompulsory' value='1' ng-model='question.isCompulsory'>Compulsory</label>
            </div>
        </div>


        <div class="control-group form-horizontal" ng-show='isChapter' ng-class="{error: myForm.name.$invalid}">
            <label class='control-label' for="question.description">Description</label>
            <div class='controls control-row span10'>
                <textarea class='span6' type="text" name="name" ng-model="question.description"></textarea>
                <span ng-show="myForm.name.$error.required" class="help-inline">Required</span>
            </div>
        </div>


        <br/><br/>









        <div class="control-group form-horizontal row-fluid">
            <label class='control-label' for="question.chapter">Belongs to chapter</label>
            <div class='controls span10'>
                <div class='span6'>
                    <select class='span12'
                            name="question.chapter"
                            ng-model="question.chapter.id"
                            ng-options="p.id as p.name for p in chapterList">
                    </select>
                </div>
                <div class='span1'><button class="span12 btn btn-danger btn-xs" ng-click="removeChapter()" ><i class="icon-trash"></i></button></div>
            </div>
        </div>

        <div class="control-group form-horizontal row-fluid" ng-show='isChapter'>
            <label class='control-label' for="question.isFinal">Display mode</label>
            <div class='controls span10'>
                <label class='radio'><input type='radio' name='question.isFinal' value='0' ng-model='question.isFinal' ng-checked="1">Behaves like a folder : every subquestion is displayed on its own page</label>
                <label class='radio'><input type='radio' name='question.isFinal' value='1' ng-model='question.isFinal'>Behaves like a question : displays all subquestions in the current page</label>
            </div>
        </div>




        <div class="control-group form-horizontal row-fluid" ng-hide='isChapter' ng-class="{error: myForm.filter.$invalid}">
            <label class='control-label' for="question.filter">Thematic</label>
            <div class='controls span10'>
                <gims-select    required
                                class='span6'
                                name='filter'
                                api="filter"
                                model="question.filter"
                                placeholder="Select a thematic">
                </gims-select>
                <span ng-show="myForm.filter.$error.required" class="span1 help-inline">Required</span>
            </div>

        </div>



		<div class="control-group form-horizontal row-fluid" ng-hide='isChapter' ng-class="{error: myForm.zone.$invalid}">
		    <label class='control-label' for="question.part">Zone</label>
            <div class='controls span10'>
                <gims-select    required
                                class="span6 input-medium"
                                name="zone"
                                api="part"
                                model="question.parts"
                                multiple="multiple">
                </gims-select>
                <span ng-show="myForm.zone.$error.required" class="span1 help-inline">Required</span>
            </div>
		</div>
        <br/>



        <br/>
        <div ng-repeat="choice in question.choices" ng-show="isChoices" >

            <div ng-form name='myInnerForm' class="control-group form-horizontal row-fluid" ng-class="{error:myInnerForm.choiceName.$invalid}">
                <label class='control-label' for="choiceLabel">Option {{$index+1}}</label>
                <div class='controls span10'>
                    <div class='span8'><input id="choiceLabel" type="text" name="choiceName" ng-model="choice.name" class='span12' ng-required='isChoices'/></div>
                    <div class='span1'>
                        <select ng-required='isChoices'
                                ng-hide='question.isMultiple'
                                class="input-small span12"
                                name="type"
                                ng-model="choice.value"
                                ng-options="p.value as p.text for p in percentages">
                        </select>
                    </div>
                    <div class='span1'><button class="span12 btn btn-danger btn-xs" ng-click="deleteOption($index)" ><i class="icon-trash"></i></button></div>
                    <span ng-show="myInnerForm.choiceName.$error.required" class="span1 help-inline">Required</span>
                </div>
            </div>

        </div>

        <br/>
        <div class="control-group form-horizontal" ng-show='isChoices'>
            <label class='control-label'>&nbsp;</label>
            <div class='controls'>
                <button class="btn btn-success btn-xs" ng-click="addOption()"><i class="icon-plus"></i> Add choice</button>
            </div>

            <br/><br/>
        </div>



        <div class="control-group form-horizontal" ng-class="{error: myForm.sorting.$invalid}" ng-show="question.id">
            <label class='control-label' for="question.sorting">Sorting</label>
            <div class='controls controls-row'>
                <input class='span1' type="text" name="sorting" ng-model="question.sorting"/>
            </div>
        </div>


        <div class="control-group form-horizontal" ng-show='isChapter' >
            <label class='control-label' for="question.sorting">Included questions</label>
            <div class='controls'>
                <div gims-grid-question></div>
            </div>
        </div>



    </form>

    <?php echo $this->metadata('question'); ?>
</div>