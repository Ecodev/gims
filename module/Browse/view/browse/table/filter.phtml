<style ng-if="data.mode.isNsa">
    #filtersSectionHeader, #questionnairesHeaderSection{
        height:247px; /* 6 * 41 +1 */
    }
</style>

<style ng-if="!data.mode.isNsa">
    #filtersSectionHeader, #questionnairesHeaderSection{
        height:206px; /* 5 * 41 */
    }
</style>

<div disable-animate class="container">
    <button ng-click="grid()">GRID ME !</button>
    <div id="tools">

        <!-- Toolbar -->
        <div class="navbar navbar-default hidden-print">
            <a class="navbar-brand" href="#">{{::data.mode.name}}</a>

            <form class="navbar-form">
                <!-- Save all the new questionnaires -->
                <button class="btn btn-primary" ng-if="hasUnsavedElement()" ng-click="saveAll();" ng-disabled="isLoading || !data.filters && !data.questionnaires"><i class="fa fa-save"></i> Save new elements</button>

                <!-- link to chart -->
                <a class="btn btn-default" href="/browse/chart?geonames={{data.geonamesIds}}&part=1&filterSet={{data.filterSet.id}}&filters={{data.filtersIds}}"><i class="fa fa-line-chart"></i> View in chart</a>

                <!-- Clear the selection -->
                <a href class="btn btn-default" ng-click="data.questionnaires = []; data.filters = []; data.filterSet = null; data.geoname = null; data.filter = null; data.survey = null"><i class="fa fa-eraser"></i> Clear selection</a>

                <!-- Hide/Show selection tools and/or children filters -->
                <button class="btn btn-default" ng-click="expandSelection = !expandSelection;"><i class="fa" ng-class="{'fa-compress':expandSelection,'fa-expand text-primary':!expandSelection}"></i> Selection</button>

                <!-- Show all original nominations -->
                <button class="btn btn-default" ng-click="toggleShowLabels()"><i class="fa fa-question"></i> Show/Hide question labels</button>

                <gims-discussion-menu questionnaires="data.questionnaires" filters="data.filters"></gims-discussion-menu>

                <?php echo $this->helpButton(); ?>
            </form>
        </div>

        <div ng-switch="::data.mode.name">
            <div ng-switch-when="Browse">
                <?php echo $this->helpBox('Select a country and filter set and view the corresponding data. For further info, see the <a target="_blank" href="http://gims.readthedocs.org/en/develop/content/data_processing.html">detailed documentation</a>.'); ?>
            </div>
            <div ng-switch-when="Contribute JMP">
                <?php echo $this->helpBox('Select questionnaires and filters and edit existing or new data. For further info, see the <a target="_blank" href="http://gims.readthedocs.org/en/develop/content/data_input2.html#di-jmp">detailed documentation</a>.'); ?>
            </div>
            <div ng-switch-when="Contribute NSA">
                <?php echo $this->helpBox('Select a country and edit existing or new data. For further info, see the <a target="_blank" href="http://gims.readthedocs.org/en/develop/content/data_input2.html#di-nsa">detailed documentation</a>.'); ?>
            </div>
        </div>

        <!-- Selection panel for filters and questionnaires -->
        <form name="selectionForm">
            <div class="row show-grid" ng-show="expandSelection">

                <!-- Filter selection -->
                <div class="col-md-6" ng-if="(data.questionnaires.length || data.mode.isContribute) && !data.mode.isNsa">
                    <div class="row" ng-class="{'has-error':!data.filters.length}">
                        <div class="col-md-12">
                            <h3 class="control-label">Filter (rows) <small ng-if="!data.filters.length">(Required)</small></h3>
                        </div>

                        <div class="col-md-12">
                            <tabset>
                                <tab heading="Filter set">
                                    <gims-select
                                        model="data.filterSet"
                                        api="filterSet"
                                        placeholder="Select filter set"
                                        disabled="isLoading"
                                        style="width: 100%">
                                    </gims-select>
                                </tab>
                                <tab heading="Filter's children">
                                    <gims-filter
                                        model="data.filter"
                                        name="filter"
                                        query-params="filterFields"
                                        disabled="isLoading">
                                    </gims-filter>

                                </tab>
                                <tab heading="Filters ({{data.filters.length}})">
                                    <gims-filter
                                        model="data.filters"
                                        name="filters"
                                        query-params="filterFields"
                                        disabled="isLoading"
                                        bgColor="true"
                                        dependencies="filterSet,filter"
                                        multiple="true">
                                    </gims-filter>
                                </tab>
                            </tabset>
                        </div>
                    </div>
                </div>

                <!-- Questionnaires selection -->
                <div class="col-md-6">
                    <div class="row" ng-class="{'has-error':!data.questionnaires.length && !data.mode.isContribute}">

                        <div>
                            <div class="col-md-12">
                                <h3 class="control-label" ng-if="::!data.mode.isNsa">Questionnaires (columns) <small ng-if="!data.questionnaires.length && !data.mode.isContribute">(Required)</small></h3>
                            </div>

                            <div class="col-md-12">
                                <tabset>
                                    <tab heading="Country">
                                        <gims-select
                                            model="data.geoname"
                                            api="geoname"
                                            placeholder="Select a country"
                                            change-url="::data.mode.isNsa"
                                            disabled="isLoading"
                                            style="width: 100%">
                                        </gims-select>
                                    </tab>
                                    <tab heading="Survey" ng-if="::!data.mode.isNsa">
                                        <gims-select
                                            model="data.survey"
                                            api="survey"
                                            queryparams="surveyParams"
                                            placeholder="Select survey"
                                            change-url="false"
                                            disabled="isLoading"
                                            style="width: 100%">
                                        </gims-select>
                                    </tab>
                                    <tab heading="Questionnaires ({{data.questionnaires.length}})" ng-if="::!data.mode.isNsa">
                                        <gims-select
                                            model="data.questionnaires"
                                            name="questionnaires"
                                            api="questionnaire"
                                            queryparams="questionnaireParams"
                                            placeholder="Select questionnaires"
                                            disabled="isLoading"
                                            multiple
                                            style="width: 100%">
                                        </gims-select>
                                    </tab>
                                </tabset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

    </div>
</div>

<!-- Table of filters, questionnaires and answers. Display in full width when there are too much elements -->
<div disable-animate ng-if="(data.mode.isNsa && data.filter) || data.filters.length && (data.questionnaires.length || data.mode.isContribute)" class="container gims-full-width-container" ng-init="initScrollAndHeight()">

    <div class="row">
        <div class="col-md-12">
            <form name="answersForm" novalidate>



            </form>
        </div>
    </div>
</div>

<gims-rule-text-field-panel refresh="refresh(questionnairesPermissions, filtersComputing, questionnairesUsages)" readonly="!data.mode.isContribute"></gims-rule-text-field-panel>
