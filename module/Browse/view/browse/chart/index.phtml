<div class="container">
    <form>
        <div class='row show-grid'>
            <div class="col-md-6">
                <img src="/img/jmp-logo-black.png" alt="JMP logo" class="logo-chart"/>
                <img src="/img/who-logo-black.png" alt="WHO logo" class="logo-chart"/>
                <img src="/img/unicef-logo-black.png" alt="Unicef logo" class="logo-chart"/>
            </div>
        </div>
        <div class="row">
            <p class='col-sm-6 col-md-6'><gims-select api="country" model="country" placeholder="<?php echo $this->translate('Select a country') ?>" format="name" style="width:100%;"/></p>
        </div>
        <div class="row">
            <p class='col-sm-6 col-md-6'><gims-select api="filterSet" model="filterSet" placeholder="<?php echo $this->translate('Select a filter set') ?>" style="width:100%;"/></p>
        </div>
        <div class="row show-grid">
            <div class="col-xs-6 col-sm-4 col-md-2">
                <p><gims-select api="part" model="part" placeholder="<?php echo $this->translate('Select a part') ?>" style="width:100%;"/></p>
            </div>
            <p class="col-xs-6 col-sm-2 col-md-2">
                <i class="fa fa-loading fa-2x" ng-show="isLoading"></i>
            </p>
        </div>
    </form>

    <div class="alert alert-info" ng-hide="chart"><i class="fa fa-info-circle"></i> <?php echo $this->translate('Select parameters to plot a chart here.') ?></div>

    <div class="row">

        <!-- Chart -->
        <div ng-class="{'col-xs-12 col-sm-8 col-md-8 col-lg-10' : ignoredFilters || ignoredQuestionnaires || pointSelected, 'col-md-12' : !ignoredFilters && !ignoredQuestionnaires && !pointSelected}" >
            <chart value="chart" type="area" height="400" chart-obj="chartObj" />
        </div>

        <!-- Right panel -->
        <div id='chartPanel' ng-show='ignoredFilters || ignoredQuestionnaires || pointSelected' class="col-xs-12 col-sm-4 col-md-4 col-lg-3">

            <div ng-show='pointSelected'>
                <button class="pull-right btn btn-default" ng-click="pointSelected=null"><i class="fa fa-times"></i></button>
                <h3 ng-class="{'unselected':cachedElements[country.id][part.id][filterSet.id][pointSelected.filter].questionnaires[pointSelected.questionnaire].ignored}">
                    {{pointSelected.name}}
                    <span class="btn btn-link" ng-click="toggleQuestionnaire(pointSelected.filter,pointSelected.questionnaire)" ng-class="{disabled: isLoading}">
                        <span ng-show="cachedElements[country.id][part.id][filterSet.id][pointSelected.filter].questionnaires[pointSelected.questionnaire].ignored" ><i class="fa fa-eye-slash"></i> <?php echo $this->translate('Include questionnaire') ?></span>
                        <span ng-show="!cachedElements[country.id][part.id][filterSet.id][pointSelected.filter].questionnaires[pointSelected.questionnaire].ignored"><i class="fa fa-eye"></i> <?php echo $this->translate('Ignore questionnaire') ?></span>
                    </span>
                </h3>
                <h4>{{cachedElements[country.id][part.id][filterSet.id][pointSelected.filter].name}}</h4>

                <div class='row show-grid'>
                    <table class='table'>
                        <tr>
                            <th colspan='3'>
                                <span class='btn-link' style='margin-right:15px' ng-click="ignoreAllFiltersForAllHighFilterQuestionnaires(pointSelected.filter, cachedElements[country.id][part.id][filterSet.id][pointSelected.filter].filters[0].ignored)">
                                    <span ng-show='allIgnored'><i class="fa fa-eye"></i> Include all</span>
                                    <span ng-show='!allIgnored'><i class="fa fa-eye-slash"></i> Ignore all</span>
                                </span>
                                <span class="btn-link" ng-click="openNewFilterSet()"><i class="fa fa-save"></i> <?php echo $this->translate('Save in new filter set') ?></span>
                            </th>
                        </tr>
                        <tr ng-repeat="filter in cachedElements[country.id][part.id][filterSet.id][pointSelected.filter].filters track by $index"  ng-show="filter.filter.id" ng-class="{'unselected': filter.ignored}">
                            <td style='width:5%'><div ng-click="toggleFilterForAllQuestionnaires(filter)"><i ng-class="{'fa fa-eye':!filter.ignored, 'fa fa-eye-slash':filter.ignored}"></i></div></td>
                            <td style="padding-left:{{filter.filter.level}}em;">{{filter.filter.name}}</td>
                            <td style='width:10%'>{{cachedElements[country.id][part.id][filterSet.id][pointSelected.filter].questionnaires[pointSelected.questionnaire].filters[filter.filter.id].value}}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Panel bottom part : ignored elements -->
            <div ng-show='ignoredFilters || ignoredQuestionnaires'>
                <h2>Ignored elements</h2>
                <div ng-repeat='(hFilterId, hFilter) in cachedElements[country.id][part.id][filterSet.id]' ng-show='hFilter.ignoredQuestionnaires || hFilter.ignoredFilters'>
                    <h4>{{hFilter.name}}</h4>

                    <div class='row show-grid'>
                        <table class='table' ng-show='hFilter.ignoredQuestionnaires'>
                            <tr>
                                <th colspan='3' style='padding-left:1.5em'>Questionnaires</th>
                            </tr>
                            <tr ng-repeat="questionnaire in hFilter.questionnaires" ng-show='questionnaire.ignored' ng-class="{'unselected': questionnaire.ignored}">
                                <td style='width:5%'><div ng-click="questionnaire.ignored=!questionnaire.ignored;refreshChart()"><i ng-class="{'fa fa-eye':!filter.ignored, 'fa fa-eye-slash':filter.ignored}"></i></div></td>
                                <td >{{questionnaire.name}}</td>
                            </tr>
                        </table>

                        <table class='table' ng-show="hFilter.ignoredFilters">
                            <tr>
                                <th colspan='3' style='padding-left:1.4em'>Filters <span class='btn-link' style='margin-left:10px' ng-click="ignoreAllFiltersForAllHighFilterQuestionnaires(hFilterId, false)"><i class="fa fa-eye"> </i> Include all</span></th>
                            </tr>
                            <tr ng-repeat="filter in hFilter.filters track by $index" ng-show='filter.filter.id && filter.ignored' ng-class="{'unselected': filter.ignored}">
                                <td style='width:5%'><div ng-click="filter.ignored=!filter.ignored;refreshChart()"><i ng-class="{'fa fa-eye':!filter.ignored, 'fa fa-eye-slash':filter.ignored}"></i></div></td>
                                <td style="padding-left: {{filter.filter.level}}em;">{{filter.filter.name}}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Login Window !-->
<script type="text/ng-template" id="newFilterSet.html">
    <form name="myForm">
        <div class="modal-header">
            <h3>Create new Filter Set</h3>
        </div>
        <div class="modal-body">
                <div class="form-group" ng-class="{'has-error': myForm.filterSetName.$invalid}">
                    <label class="control-label" for="filterSetName">Filter name</label>
                    <input id="filterSetName" name="filterSetName" ng-model="newFilterSet.name" type="text" placeholder="Enter a filter set name..." autofocus="autofocus" required>
                    <span ng-show="myForm.filterSetName.$error.required" class="help-block">Required</span>
                </div>
        </div>
        <div class="modal-footer">
            <a class="btn btn-default cancel" ng-click="cancelNewFilterSet()"><?php echo $this->translate('Cancel') ?></a>
            <button class="btn btn-primary" ng-click="createNewFilterSet()" ng-disabled="myForm.$invalid"><?php echo $this->translate('Create') ?></button>
        </div>
    </form>
</script>