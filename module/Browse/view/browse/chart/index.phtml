<div class="container" ng-init="firstCol='4.5em';lastCol='7em';">

    <div class='row'>

        <div ng-class="{'col-xs-12 col-sm-7 col-md-7 col-lg-8' : hasIgnoredElements || pointSelected, 'col-md-12' : !hasIgnoredElements && !pointSelected}">
<!--            <div class='navbar navbar-default hidden-print'>-->
<!--                <div class='navbar-form' id='nav-chart'>-->
<!--                    <a class='btn btn-default' ng-class="{'disabled': !country}" href="/contribute/questionnaire?sector&country={{country.id}}&returnUrl={{currentUrl}}"><i class='fa fa-plus'></i> Add new sector dataset</a>-->
<!--                    <a class='btn btn-default' ng-class="{'disabled': !country || !filterSet}" href="/contribute/questionnaire?&country={{country.id}}&filterSet={{getFilterSets()}}&returnUrl={{currentUrl}}"><i class='fa fa-pencil'></i> Edit used filters</a>-->
<!--                    <a class='btn btn-default' ng-class="{'disabled': !country || !editableFilter}" href="/contribute/questionnaire?&country={{country.id}}&filter={{editableFilter}}&returnUrl={{currentUrl}}"><i class='fa fa-pencil'></i> Edit selected filter</a>-->
<!--                </div>-->
<!--            </div>-->

            <div class='row show-grid'>
                <form>

                    <div class='col-md-6'>
                        <h2>
                            Select data
                            <i class="fa fa-gims-loading pull-right" ng-show="isLoading"></i>
                        </h2>
                        <div class='form-group'>
                            <label class='form-label'>Country</label>
                            <gims-select api="country" model="country" queryparams='countryQueryParams' placeholder="<?php echo $this->translate('Select a country') ?>" format="name" style="width:100%;"/>
                        </div>
                        <div class='form-group'>
                            <label class='form-label'>Part</label>
                            <gims-select api="part" model="part" placeholder="<?php echo $this->translate('Select a part') ?>" style="width:100%;"/>
                        </div>

                        <div class='form-group'>
                            <label class='form-label'>Filter sets</label>
                            <gims-select api="filterSet" model="filterSet" queryparams='filterSetQueryParams' multiple placeholder="<?php echo $this->translate('Select a filter set') ?>" style="width:100%;"/>
                        </div>

                    </div>
                    <div class='col-md-6'>
                        <h2>Manipulate data</h2>
                        <div class='form-group'>
                            <div class='row show-grid'>
                                <div class='col-md-12'>
                                    <label class='form-label'>New dataset</label>
                                </div>
                                <div class='col-md-12'>
                                    <a class='btn btn-default' href="/contribute/questionnaire?sectorChildren&returnUrl={{currentUrl}}"><i class='fa fa-plus'></i> Create new dataset</a>
                                </div>
                            </div>
                            <div class='row show-grid' ng-show='filterSet'>
                                <div class='col-md-12'>
                                    <label class='form-label'>Edit existing</label>
                                </div>
                                <div class='col-md-12'>

                                    <ul class='list-unstyled'>
                                        <li class='pull-left' style='margin-bottom:5px;margin-right:5px;'><a class='btn btn-primary' ng-class="{'disabled': !country || !filterSet}" href="/contribute/questionnaire?&country={{country.id}}&filterSet={{getFilterSets()}}&returnUrl={{currentUrl}}"><i class='fa fa-pencil'></i> Edit all</a></li>
                                        <li ng-repeat="filter in usedFilters" class='pull-left' style='margin-bottom:5px;margin-right:5px;'>
                                            <a class='btn btn-default' href="/contribute/questionnaire?&country={{country.id}}&filter={{filter.id}}&returnUrl={{currentUrl}}"><i class='fa fa-pencil' style='color:{{filter.genericColor}}'></i> {{filter.name}}</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                <!--                <div class='col-md-6'>-->
<!--                    <p class='text-right'>-->
<!--                        <img src="/img/jmp-logo-black.png" alt="JMP logo" class="logo-chart"/>-->
<!--                        <img src="/img/who-logo-black.png" alt="WHO logo" class="logo-chart"/>-->
<!--                        <img src="/img/unicef-logo-black.png" alt="Unicef logo" class="logo-chart"/>-->
<!--                    </p>-->
<!--                </div>-->
            </div>
        </div>
    </div>

    <div class="alert alert-info ng-trans ng-trans-fade-up" ng-hide="chart"><i class="fa fa-info-circle"></i> <?php echo $this->translate('Select parameters to plot a chart here.') ?></div>

    <div class="row show-grid">

        <!-- Chart -->
        <div ng-show='chart' class='ng-trans ng-trans-fade-down' ng-class="{'col-xs-12 col-sm-7 col-md-7 col-lg-8' : hasIgnoredElements || pointSelected, 'col-md-12' : !hasIgnoredElements && !pointSelected}" >

            <chart value="chart" type="area" height="400" chart-obj="chartObj" />

            <h2 class="text-center">Estimated coverage</h2>
            <div ng-grid="gridOptions" class="gridStyle"></div>
        </div>

        <!-- Right panel -->
        <div id='chartPanel' class="ng-trans ng-trans-slide-right easeInOutSine col-xs-12 col-sm-5 col-md-5 col-lg-4"  ng-animate ng-show='hasIgnoredElements || pointSelected' >

            <!-- Panel top part : selected questionnaire and filters -->
            <div ng-show='pointSelected'>
                <button class="pull-right btn btn-default" ng-click="pointSelected=null"><i class="fa fa-times"></i></button>

                <h3 ng-class="{'text-muted': indexedElements[pointSelected.questionnaire].ignored}">
                    <i class="fa fa-gims-questionnaire"
                       ng-class="{'text-primary fa-eye': !indexedElements[pointSelected.questionnaire].ignored}"
                       ng-click="toggleQuestionnaire(pointSelected.questionnaire)"></i>
                        {{indexedElements[pointSelected.questionnaire].name}}
                </h3>

                <div class='row show-grid'>
                    <table class='table'>

                        <!-- filters -->
                        <tbody ng-repeat="(hFilterId, hFilter) in indexedElements[pointSelected.questionnaire].hFilters">

                            <tr ng-repeat="key in sort(indexedElements[pointSelected.questionnaire].filters, hFilterId)" ng-show="indexedElements[pointSelected.questionnaire].filters[key].filter.hFilters[hFilterId].level >= 0" ng-class="{'active':indexedElements[pointSelected.questionnaire].filters[key].filter.id == hFilterId,'text-muted':indexedElements[pointSelected.questionnaire].filters[key].filter.ignored}" >
                                <td style='width:{{firstCol}};padding-right:0' >
                                    <span ng-switch="indexedElements[pointSelected.questionnaire].filters[key].filter.ignored" ng-click="ignoreFilter(indexedElements[pointSelected.questionnaire].filters[key], !indexedElements[pointSelected.questionnaire].filters[key].filter.ignored, true, pointSelected.questionnaire)">
                                        <i ng-switch-when="true" class="fa fa-lg fa-gims-filter text-muted"></i>
                                        <i ng-switch-default class="fa fa-lg fa-gims-filter" style="color:{{usedFilters[hFilterId].genericColor}}" ></i>
                                    </span>
                                    <i ng-if="globalIndexedFilters[indexedElements[pointSelected.questionnaire].filters[key].filter.id] == null && indexedElements[pointSelected.questionnaire].filters[key].filter.ignored" class="fa fa-gims-questionnaire opacity33" style="color:{{usedFilters[hFilterId].genericColor}}" ng-click="reportStatusGlobally(indexedElements[pointSelected.questionnaire].filters[key], true, pointSelected.questionnaire)" tooltip-placement="right" tooltip="Ignore filter for all questionnaire"></i>
                                    <i ng-if="globalIndexedFilters[indexedElements[pointSelected.questionnaire].filters[key].filter.id] == null && !indexedElements[pointSelected.questionnaire].filters[key].filter.ignored" class="fa fa-gims-questionnaire opacity33" style="color:{{usedFilters[hFilterId].genericColor}}" ng-click="reportStatusGlobally(indexedElements[pointSelected.questionnaire].filters[key], false, pointSelected.questionnaire)" tooltip-placement="right" tooltip="Include filter for all questionnaire"></i>
                                    <i ng-if="globalIndexedFilters[indexedElements[pointSelected.questionnaire].filters[key].filter.id] == false" class="fa fa-gims-questionnaire" style="color:{{usedFilters[hFilterId].genericColor}}" ng-click="reportStatusGlobally(indexedElements[pointSelected.questionnaire].filters[key], true, pointSelected.questionnaire)" tooltip-placement="right" tooltip="Ignore filter for all questionnaire"></i>
                                    <i ng-if="globalIndexedFilters[indexedElements[pointSelected.questionnaire].filters[key].filter.id] == true" class="fa fa-gims-questionnaire text-muted" ng-click="reportStatusGlobally(indexedElements[pointSelected.questionnaire].filters[key], false, pointSelected.questionnaire)" tooltip-placement="right" tooltip="Include filter for all questionnaire"></i>

                                    <i ng-if="indexedElements[pointSelected.questionnaire].filters[key].usages" class='fa fa-lg fa-gims-rule' style="color:{{usedFilters[hFilterId].genericColor}}"></i> <!--tooltip-placement="right" tooltip="{{indexedElements[pointSelected.questionnaire].filters[key].usages}}"-->
                                </td>
                                <td style="padding-left:{{indexedElements[pointSelected.questionnaire].filters[key].filter.hFilters[hFilterId].level+1}}em;">
                                    <span tooltip="{{indexedElements[pointSelected.questionnaire].filters[key].filter.originalDenomination}}" tooltip-placement="right">
                                        {{indexedElements[pointSelected.questionnaire].filters[key].filter.name}}&nbsp;<a href='/admin/filter/edit/{{key}}' target='_blank'><i class='fa fa-pencil'></i></a>
                                    </span>
                                </td>
                                <td style='width:{{lastCol}}' class='text-right'>
                                    <span ng-if='indexedElements[pointSelected.questionnaire].filters[key].ignored || !indexedElements[pointSelected.questionnaire].filters[key].ignored && indexedElements[pointSelected.questionnaire].filters[key].valuesWithoutIgnored[part.name] === undefined'>
                                        <span ng-show='indexedElements[pointSelected.questionnaire].filters[key].values[part.name]' class='text-success'>
                                            {{indexedElements[pointSelected.questionnaire].filters[key].values[part.name]}}&nbsp;%
                                            <i class='fa fa-check-circle-o fa-fw'></i>
                                        </span>
                                    </span>
                                    <span ng-if='!indexedElements[pointSelected.questionnaire].filters[key].ignored'>
                                        <span ng-show='indexedElements[pointSelected.questionnaire].filters[key].valuesWithoutIgnored[part.name]' class='text-warning'>
                                            {{indexedElements[pointSelected.questionnaire].filters[key].valuesWithoutIgnored[part.name]}}&nbsp;%
                                            <i class='fa fa-exclamation-triangle fa-fw'></i>
                                        </span>
                                    </span>
                                    <span ng-if='!indexedElements[pointSelected.questionnaire].filters[key].ignored && indexedElements[pointSelected.questionnaire].filters[key].valuesWithoutIgnored[part.name] === null'>
                                        <span ng-show='indexedElements[pointSelected.questionnaire].filters[key].values[part.name]' class='text-danger'>
                                            {{indexedElements[pointSelected.questionnaire].filters[key].values[part.name]}}&nbsp;%
                                            <i class='fa fa-times-circle-o fa-fw'></i>
                                        </span>
                                    </span>
                                </td>
                            </tr>
                        </tbody>

                        <!-- Questionnaire Usages -->
                        <tbody ng-if="indexedElements[pointSelected.questionnaire].usages">
                            <tr class="active">
                                <td  style='width:{{firstCol}}'>
                                    <i class='fa fa-lg fa-gims-rule'></i>
                                </td>
                                <td colspan='2'>Questionnaire's calculations / ratios / estimates</td>
                            </tr>
                            <tr ng-repeat="usage in indexedElements[pointSelected.questionnaire].usages | orderBy:'rule.name'">
                                <td style='width:{{firstCol}}' ><i class='fa fa-lg fa-gims-rule'></i></td>
                                <td colspan='1'>{{usage.rule.name}}</td>
                                <td style='width:{{lastCol}}' class='text-right'>
                                    <span ng-show='usage.value'>
                                        {{usage.value}} %
                                    </span>
                                </td>
                            </tr>
                        </tbody>

                    </table>
                </div>
            </div>

            <!-- Panel bottom part : ignored elements -->
            <div ng-show='hasIgnoredElements'>
                <h3 class='text-center'>Ignored elements</h3>

                <!-- foreach hFilter -->
                <div ng-repeat="(questionnaireId, ignoredFilters) in ignoredElements" class='row show-grid' ng-show='indexedElements[questionnaireId].hasIgnoredFilters'>

                    <table class='table'>
                        <tr class='active'>
                            <th style='width:{{firstCol}}'>
                                <i class='fa fa-lg'> </i>
                                <i class='fa fa-lg'> </i>
                                <i class="fa fa-lg fa-gims-filter text-primary" ng-click="toggleQuestionnaire(questionnaireId, false)" tooltip-placement="right" tooltip="Include filters" ></i>
                            </th>
                            <th colspan='2'>
                                <i class="fa fa-gims-questionnaire" ng-class="{'text-muted':{{indexedElements[questionnaireId].name}}.ignored, 'text-primary':!questionnaire.ignored}" ng-click="toggleQuestionnaire(questionnaireId, true)" tooltip-placement="right" tooltip="Ignore whole questionnaire"></i>
                                <span class='btn-link' ng-click="setPointSelected(null,questionnaireId,null,null)">{{indexedElements[questionnaireId].name}}</span>
                            </th>
                        </tr>

                        <!-- Excluded Filters -->
                        <tbody ng-repeat="(hFilterId, hFilter) in indexedElements[questionnaireId].hFilters">
                        <tr ng-repeat="key in sort(indexedElements[questionnaireId].filters, hFilterId)" ng-show='indexedElements[questionnaireId].filters[key].filter.hFilters[hFilterId].level >= 0 && indexedElements[questionnaireId].filters[key].filter.ignored' class='text-muted'>
                            <td style='width:{{firstCol}}'>
                                <i class="fa fa-lg fa-gims-filter text-muted" ng-click="ignoreFilter(indexedElements[questionnaireId].filters[key], !indexedElements[questionnaireId].filters[key].filter.ignored, true)"></i>
                                <i ng-if="globalIndexedFilters[key] == null && indexedElements[questionnaireId].filters[key].filter.ignored" class="fa fa-gims-questionnaire opacity33" style="color:{{usedFilters[hFilterId].genericColor}}" ng-click="reportStatusGlobally(indexedElements[questionnaireId].filters[key], true)" tooltip-placement="right" tooltip="Ignore filter for all questionnaire"></i>
                                <i ng-if="globalIndexedFilters[key] == null && !indexedElements[questionnaireId].filters[key].filter.ignored" class="fa fa-gims-questionnaire opacity33" style="color:{{usedFilters[hFilterId].genericColor}}" ng-click="reportStatusGlobally(indexedElements[questionnaireId].filters[key], false)" tooltip-placement="right" tooltip="Include filter for all questionnaire"></i>
                                <i ng-if="globalIndexedFilters[key] == false" class="fa fa-gims-questionnaire" style="color:{{usedFilters[hFilterId].genericColor}}" ng-click="reportStatusGlobally(indexedElements[questionnaireId].filters[key], true)" tooltip-placement="right" tooltip="Ignore filter for all questionnaire"></i>
                                <i ng-if="globalIndexedFilters[key] == true" class="fa fa-gims-questionnaire text-muted" ng-click="reportStatusGlobally(indexedElements[questionnaireId].filters[key], false)" tooltip-placement="right" tooltip="Include filter for all questionnaire"></i>
                            </td>
                            <td style="padding-left:{{indexedElements[questionnaireId].filters[key].filter.hFilters[hFilterId].level+1}}em;">
                                {{indexedElements[questionnaireId].filters[key].filter.name}}&nbsp;<a href='/admin/filter/edit/{{key}}' target='_blank'><i class='fa fa-pencil'></i></a>
                            </td>
                            <td style='width:{{lastCol}}' class='text-right'>
                                <span ng-show='indexedElements[questionnaireId].filters[key].values[part.name]' class='text-danger'>
                                    {{indexedElements[questionnaireId].filters[key].values[part.name]}}&nbsp;%
                                    <i class='fa fa-times-circle-o fa-fw'></i>
                                </span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
