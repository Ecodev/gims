<div class="container">
    <form>
        <div class='row show-grid'>
            <div class="col-md-6">
                <img src="/img/jmp-logo-black.png" alt="JMP logo" class="logo-chart"/>
                <img src="/img/who-logo-black.png" alt="WHO logo" class="logo-chart"/>
                <img src="/img/unicef-logo-black.png" alt="Unicef logo" class="logo-chart"/>
            </div>
        </div>
        <div class="row">
            <p class='col-sm-6 col-md-6'><gims-select api="country" model="country" placeholder="<?php echo $this->translate('Select a country') ?>" format="name" style="width:100%;"/></p>
        </div>
        <div class="row">
            <p class='col-sm-6 col-md-6'><gims-select api="filterSet" model="filterSet" queryparams='filterSetQueryParams' multiple placeholder="<?php echo $this->translate('Select a filter set') ?>" style="width:100%;"/></p>
        </div>
        <div class="row">
            <div class="col-xs-6 col-sm-4 col-md-2">
                <p><gims-select api="part" model="part" placeholder="<?php echo $this->translate('Select a part') ?>" style="width:100%;"/></p>
            </div>
            <p class="col-xs-6 col-sm-2 col-md-2">
                <i class="fa fa-loading fa-2x" ng-show="isLoading"></i>
            </p>
        </div>
        <div class='row show-grid'>
            <p class='col-sm-1 col-md-1'>
                <gims-filter-generator></gims-filter-generator>
            </p>
        </div>
    </form>

    <div class="alert alert-info" ng-hide="chart"><i class="fa fa-info-circle"></i> <?php echo $this->translate('Select parameters to plot a chart here.') ?></div>

    <div class="row">

        <!-- Chart -->
        <div ng-class="{'col-xs-12 col-sm-7 col-md-7 col-lg-8' : ignoredElements || pointSelected, 'col-md-12' : !ignoredElements && !pointSelected}" >
            <chart value="chart" type="area" height="400" chart-obj="chartObj" />
            <!--pre>{{usedFilters|json}}</pre>
            <pre>{{pointSelected|json}}</pre>
            <pre>{{indexedElements|json}}</pre-->
        </div>

        <!-- Right panel -->
        <div id='chartPanel' class="col-xs-12 col-sm-5 col-md-5 col-lg-4" ng-show='ignoredElements || pointSelected' >

            <!-- Panel top part : selected questionnaire and filters -->
            <div ng-show='pointSelected'>
                <button class="pull-right btn btn-default" ng-click="pointSelected=null"><i class="fa fa-times"></i></button>

                <h3 ng-class="{'text-muted': indexedElements[pointSelected.questionnaire].ignored}">
                    <i class="fa"
                       ng-class="{'fa-eye-slash': indexedElements[pointSelected.questionnaire].ignored, 'text-primary fa-eye': !indexedElements[pointSelected.questionnaire].ignored}"
                       ng-click="toggleQuestionnaire(pointSelected.questionnaire)"></i>
                       {{indexedElements[pointSelected.questionnaire].name}}
                </h3>

                <div class='row show-grid'>
                    <table class='table'>

                        <!-- filters -->
                        <tbody ng-repeat="(hFilterId, hFilter) in usedFilters">
                            <tr ng-repeat="filter in indexedElements[pointSelected.questionnaire].filters | orderBy:'filter.sorting'" ng-show="filter.filter.hFilters[hFilterId] >= 0" ng-class="{'active':filter.filter.id == hFilterId,'text-muted':filter.filter.ignored}" >
                                <td style='width:80px'>
                                    <span>
                                        <i class="fa fa-lg" ng-class="{'fa-eye-slash': filter.filter.ignored, 'text-primary fa-eye': !filter.filter.ignored}" ng-click="ignoreFilter(indexedElements[pointSelected.questionnaire], filter, !filter.filter.ignored, false, true)"></i>
                                        <i class="fa fa-arrows-alt text-muted"  ng-click="reportStatusGlobally(filter, true)"></i>
                                    </span>
                                </td>
                                <td>
                                    <div style='float:left;display:inline-block;vertical-align:middle;width:5px;height:18px;background:{{usedFilters[hFilterId]}}'></div>
                                    <div style="padding-left:{{filter.filter.hFilters[hFilterId]+1}}em;">{{filter.filter.name}}</div>
                                </td>
                                <td style='width:65px' class='text-right'>{{filter.values[part.name]}}<span ng-show='filter.values[part.name]'>&nbsp;%</span></td>
                            </tr>
                        </tbody>

                    </table>
                </div>
            </div>

            <!-- Panel bottom part : ignored elements -->
            <div ng-show='ignoredElements'>
                <h3 class='text-center'>Ignored elements</h3>

                <!-- foreach hFilter -->
                <div ng-repeat="(questionnaireId, questionnaire) in indexedElements" class='row show-grid' ng-show='questionnaire.hasIgnoredFilters' ng-class="{'text-muted':questionnaire.ignored}">

                <table class='table'>
                        <tr class='active'>
                            <th style='width:80px'>
                                <span>
                                    <i class="fa fa-lg fa-eye text-primary" ng-click="toggleQuestionnaire(questionnaireId, false)" ></i>
                                    <i class="fa fa-lg fa-eye-slash text-primary" ng-click="toggleQuestionnaire(questionnaireId, true)" ></i>
                                </span>
                            </th>
                            <th colspan='2'>
                                {{questionnaire.name}}
                                <i class='btn-link fa fa-crosshairs' ng-click="setPointSelected(null,questionnaireId,null,null)"> Select survey</i>
                            </th>
                        </tr>

                        <!-- Excluded Filters -->
                        <tbody ng-repeat="(hFilterId, hFilter) in usedFilters">
                            <tr ng-repeat="filter in questionnaire.filters | orderBy:'filter.sorting'"  ng-show='filter.filter.hFilters[hFilterId] >= 0 && filter.filter.ignored' class='text-muted'>
                                <td style='width:80px'>
                                    <span>
                                        <i class="fa fa-lg fa-eye-slash" ng-class="{'text-primary': !filter.filter.ignored}" ng-click="ignoreFilter(questionnaire, filter, !filter.filter.ignored, false, true)" ></i>
                                        <i class="fa fa-arrows-alt" ng-click="reportStatusGlobally(filter, true)" ></i>
                                        <i class="fa fa-plus-square" ng-class="{'text-muted': filter.usage.ignored}" ng-show='filter.usage' ></i>
                                    </span>
                                </td>
                                <td>
                                    <div style='float:left;display:inline-block;vertical-align:middle;width:5px;height:18px;background:{{usedFilters[hFilterId]}}'></div>
                                    <div style="padding-left:{{filter.filter.hFilters[hFilterId]+1}}em;">{{filter.filter.name}}</div>
                                </td>
                                <td style='width:65px' class='text-right'>{{filter.values[part.name]}}<span ng-show='filter.values[part.name]'>&nbsp;%</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Login Window !-->
<script type="text/ng-template" id="newFilterSet.html">
    <form name="myForm">
        <div class="modal-header">
            <h3>Create new Filter Set</h3>
        </div>
        <div class="modal-body">
                <div class="form-group" ng-class="{'has-error': myForm.filterSetName.$invalid}">
                    <label class="control-label" for="filterSetName">Filter name</label>
                    <input id="filterSetName" name="filterSetName" ng-model="newFilterSet.name" type="text" placeholder="Enter a filter set name..." autofocus="autofocus" required>
                    <span ng-show="myForm.filterSetName.$error.required" class="help-block">Required</span>
                </div>
        </div>
        <div class="modal-footer">
            <a class="btn btn-default cancel" ng-click="cancelNewFilterSet()"><?php echo $this->translate('Cancel') ?></a>
            <button class="btn btn-primary" ng-click="createNewFilterSet()" ng-disabled="myForm.$invalid"><?php echo $this->translate('Create') ?></button>
        </div>
    </form>
</script>